# Code Signing Setup Guide for Shukabase Gemini

Этот гайд описывает, как настроить подпись кода для вашего приложения, чтобы Windows Defender и другие антивирусы не выдавали сообщения об "Unknown publisher".

## Общий обзор

Для подписи кода есть несколько подходов:

1. **Платный сертификат** (Рекомендуется для production) - от $100/год
2. **Бесплатный самоподписанный сертификат** (Для разработки)
3. **GitHub Code Signing** (Бесплатно для open-source)

## Вариант 1: Использование бесплатного самоподписанного сертификата (для разработки)

### Windows

#### Генерирование ключа для Tauri (рекомендуется)

```bash
# Перейти в директорию проекта
cd shukabase-gemini

# Использовать встроенный генератор Tauri
npm run tauri signer generate -- -w your_password_here
```

Это создаст:
- Приватный ключ (храните в безопасности!)
- Публичный ключ (для дистрибьюции)

### macOS и Linux

```bash
# На macOS потребуется Apple Developer Certificate для подписи
# Это требует платной программы Apple Developer Program ($99/год)

# Для Linux обычно подпись не требуется
```

## Вариант 2: Настройка GitHub Secrets для CI/CD

### Шаг 1: Сгенерируйте ключи локально

```bash
# Используйте команду из Варианта 1
npm run tauri signer generate -- -w your_secure_password
```

### Шаг 2: Добавьте ключи в GitHub Secrets

1. Перейдите в Settings вашего репозитория
2. В левом меню выберите "Secrets and variables" → "Actions"
3. Нажмите "New repository secret"
4. Добавьте следующие secrets:

```
Name: TAURI_PRIVATE_KEY
Value: [Содержимое вашего приватного ключа]

Name: TAURI_KEY_PASSWORD
Value: [Пароль который вы использовали при генерации]
```

### Шаг 3: GitHub Actions автоматически подпишет приложение

Воркфлоу `.github/workflows/build-and-sign.yml` уже настроен использовать эти secrets!

## Вариант 3: Платный сертификат (для production)

### Поддерживаемые провайдеры:

- **Sectigo** (от $88/год)
- **DigiCert** (от $99/год) 
- **GlobalSign** (от $150/год)

### Как использовать платный сертификат:

1. Купите сертификат у провайдера
2. Получите `.pfx` или `.p12` файл
3. В GitHub Secrets добавьте:
   ```
   TAURI_PRIVATE_KEY: [Base64-encoded .pfx file]
   TAURI_KEY_PASSWORD: [пароль сертификата]
   ```
4. Примечание: сертификат должен быть в base64:
   ```bash
   # На Windows (PowerShell)
   [Convert]::ToBase64String([IO.File]::ReadAllBytes("cert.pfx"))
   
   # На macOS/Linux
   base64 -i cert.pfx | tr -d '\n'
   ```

## Как получить публичный ключ для дистрибьюции

После подписи приложений, вам нужен публичный ключ для обновлений:

```bash
# Файл с публичным ключом уже находится в вашем проекте
# Обычно: src-tauri/keys/public_key.key

# Включите его в поставку приложения или на сайт для обновлений
```

## Проверка подписи

### Windows

```bash
# Проверить свойства .exe файла
# Щелкните правой кнопкой → Свойства → Цифровые подписи
# Там должна быть информация о подписи

# Или через PowerShell:
Get-AuthenticodeSignature "path\\to\\app.exe"
```

### macOS

```bash
codesign -v /Applications/ShukabaseAI.app
```

## Что дальше?

1. Сгенерируйте ключи и добавьте их в GitHub Secrets
2. Запушьте изменения в main ветку
3. GitHub Actions автоматически собере и подпишет приложение на всех платформах
4. Скачайте артефакты из Actions → выберите workflow запуск → Downloads

## Часто задаваемые вопросы

**Q: Windows все равно показывает "Unknown publisher"?**
A: Это нормально для самоподписанного сертификата. Для полного исправления нужен платный сертификат от доверенного центра.

**Q: Могу ли я обновить ключ позже?**
A: Для обновлений приложения нужно использовать тот же публичный ключ! Не меняйте ключи между версиями.

**Q: Как часто нужно обновлять сертификат?**
A: Платные сертификаты действуют 1-3 года, затем нужно продлить.

**Q: Можно ли заработать репутацию для самоподписанного сертификата?**
A: К сожалению, нет. Только платные сертификаты дают репутацию в Windows SmartScreen.
